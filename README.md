# Integrity Protector: Модуль защиты целостности скриптов
```Ходаров Темур 10/05/2025```
[![Python Version](https://img.shields.io/badge/python-3.6+-blue.svg)](https://www.python.org/downloads/)
[![License](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

**Integrity Protector** - это простой модуль на Python, предназначенный для защиты целостности скриптов с использованием символьного пароля. Он использует алгоритм HMAC-SHA256 для создания криптографической контрольной суммы (MAC-тега) на основе содержимого скрипта и предоставленного пароля. При последующей верификации модуль проверяет, не был ли скрипт изменен с момента защиты, путем повторного вычисления контрольной суммы и ее сравнения с сохраненной.

## Основные возможности

* **Защита скрипта:** Генерация защищенного представления скрипта, включающего контрольную сумму (HMAC-SHA256), случайную соль и исходное содержимое скрипта.
* **Сохранение защищенной информации:** Сохранение защищенных данных в файл в формате JSON.
* **Загрузка защищенной информации:** Загрузка защищенных данных из файла JSON.
* **Верификация целостности:** Проверка целостности скрипта путем сравнения повторно вычисленной контрольной суммы с сохраненной.
* **Использование соли:** Применение случайной соли для повышения устойчивости к атакам.
* **Безопасное сравнение:** Использование `hmac.compare_digest` для предотвращения атак по времени при верификации.

## Установка

Для использования модуля Integrity Protector необходимо установить Python 3.6 или выше.

1.  Склонируйте репозиторий (если код распространяется через репозиторий) или скопируйте файл `integrity_protector.py` в свой проект.

## Использование

```python
from integrity_protector import IntegrityProtector

# Создание экземпляра класса IntegrityProtector
protector = IntegrityProtector(algorithm='hmac-sha256') # По умолчанию используется HMAC-SHA256

# Исходный скрипт (пример)
original_script = """
print("Hello from a protected script!")
"""

# Пароль для защиты
protection_password = "your_secret_password"

# Защита скрипта
protected_info = protector.protect_script(original_script, protection_password)
print("Защищенная информация:", protected_info)

# Сохранение защищенной информации в файл
output_file = "protected_script.json"
protector.save_protected_data(protected_info, output_file)

# Загрузка защищенной информации из файла
loaded_info = protector.load_protected_data(output_file)

if loaded_info:
    # Пароль для верификации (должен совпадать с паролем защиты)
    verification_password = "your_secret_password"

    # Верификация целостности скрипта
    is_valid = protector.verify_script(loaded_info, verification_password)

    if is_valid:
        print("Целостность скрипта подтверждена.")
        # Можно безопасно выполнять скрипт
        exec(loaded_info['script'])
    else:
        print("Внимание! Целостность скрипта нарушена.")
```

Описание кода:

IntegrityProtector Class:

__init__(self, algorithm='hmac-sha256'): Конструктор класса. По умолчанию устанавливает алгоритм HMAC-SHA256. В текущей реализации поддерживается только HMAC-SHA256.
_generate_salt(self, length=16) -> str: Приватный метод для генерации случайной соли (последовательности случайных байт в шестнадцатеричном представлении). Соль используется для повышения безопасности.
protect_script(self, script_content: str, password: str) -> Dict: Основной метод для защиты скрипта.
Генерирует случайную соль.
Кодирует скрипт и соль в байты.
Использует библиотеку hmac с алгоритмом SHA-256 и предоставленным паролем в качестве ключа для вычисления контрольной суммы (MAC-тега).
Возвращает словарь, содержащий исходный скрипт, вычисленную контрольную сумму, использованную соль и название алгоритма.
save_protected_data(self, protected_data: Dict, output_file: str): Метод для сохранения защищенной информации (словаря) в файл в формате JSON.
load_protected_data(self, input_file: str) -> Dict: Метод для загрузки защищенной информации из файла JSON.
verify_script(self, protected_data: Dict, password: str) -> bool: Метод для проверки целостности скрипта.
Извлекает скрипт, сохраненную контрольную сумму, соль и алгоритм из protected_data.
Повторно вычисляет контрольную сумму с использованием предоставленного пароля и извлеченной соли.
Использует hmac.compare_digest для безопасного сравнения вычисленной и сохраненной контрольных сумм, предотвращая атаки по времени.
Возвращает True, если контрольные суммы совпадают (целостность подтверждена), и False в противном случае.
if __name__ == "__main__": Block (Пример использования):

Создается экземпляр класса IntegrityProtector.
Определяется исходный скрипт и пароль для защиты.
Вызывается метод protect_script для получения защищенной информации.
Защищенная информация сохраняется в файл protected_script.json.
Загружается защищенная информация из файла.
Выполняются две попытки верификации: с правильным и неправильным паролем, демонстрируя, что только правильный пароль может подтвердить целостность.
Эмулируется модификация скрипта после защиты, и выполняется еще одна попытка верификации, показывая, что изменение содержимого приводит к неудачной проверке целостности.
Как использовать этот код:

Сохраните код в файл integrity_protector.py.
Запустите скрипт из командной строки: python integrity_protector.py.
Вы увидите процесс защиты скрипта, сохранения защищенной информации в файл protected_script.json и результаты попыток верификации с правильным и неправильным паролями, а также с модифицированным скриптом.
Этот код представляет собой полноценный прототип, демонстрирующий основные принципы защиты целостности скриптов с использованием HMAC-SHA256 и символьного пароля. Для реального использования в production-среде могут потребоваться дополнительные меры безопасности, обработка ошибок и более гибкая конфигурация.

